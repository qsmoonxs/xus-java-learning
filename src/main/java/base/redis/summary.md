### 分布式锁

- 如果是单机应用，那么对于共享变量，可以利用java的线程同步机制处理，比如lock等
- 但是如果是分布式系统，即多台服务器部署程序，那么那些javaapi完全没用
- 因此需要分布式锁
- CAP 即一致性，可用性，分区容错性（不明白）分布式锁可以实现分布式事务中的一致性
___

### 分布式锁的要求
- 在分布式系统下 一个方法在同一个时间只能被一台机器的一个线程执行
- 高可用，搞性能的获取锁和释放锁
- 具备可重入特性(就是一个线程可以多次获得同一个锁，线程A在没释放锁的时候可以在得到锁，比如创建事务的时候相当于得到了锁，那么第二次遇到事务注解要加入当前事务就相当于要再次获得这个锁 因为具有可重入的特性 所以没问题）
- 具备锁失效机制，防止死锁（就是具有释放锁的时间）
- 具备非阻塞锁的特性，即没有获取到锁将直接返回获取锁失败（因为直接返回结果 所以线程没有被阻塞，如果设置等待锁的时间 就是阻塞锁）

___

### 基于redis的实现方式

- JedisPool 这是一个连接池，初始化的时候要设置下config，host，port和timeout
- Jedis 一个连接 Jedis conn = jedisPool.getResource(); 获取连接
- SETNX key val：当且仅当key不存在时，set一个key为val的字符串，返回1；若key存在，则什么都不做，返回0。
- expire key timeout：为key设置一个超时时间，单位为second，超过这个时间锁会自动释放，避免死锁。
- delete key：删除key


